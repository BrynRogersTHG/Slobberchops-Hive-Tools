<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Slobberchops HIVE Tools - Who Didn't Vote?</title>
  <style>
    body { font-family: Arial, sans-serif; background-color: #f4f4f4; padding: 20px; }
    #output { white-space: pre-wrap; background: #fff; padding: 15px; border: 1px solid #ccc; border-radius: 5px; }
    .green { color: green; }
    .red { color: red; }
    .cyan { color: teal; }
  </style>
  <script>
    const apiUrl = "https://api.hive.blog";
  </script>
</head>
<body>
  <h1>Slobberchops HIVE Tools - Who Didn't Vote?</h1>

  <!-- Input for username -->
  <label for="username">Enter Hive Username:</label>
  <input type="text" id="username" placeholder="Enter username" />
  <button onclick="startAnalysis()">Analyze Most Recent Post</button>

 <!-- Added text to explain the purpose of the tool -->
 <p>You posted your latest masterpiece on the HIVE blockchain. It’s a true work of art, and I mean move over J.K. Rowling, this is going to put Harry in the shade.</p>
 <p>..the comments roll in, but wait, you smell something fishy?</p>
 <p>That person commented but you didn’t see a vote, even a lousy, measly 1% vote. They are consuming data that is earth-shattering, enough to change their whole lives and don’t have the decency to land even a tiny vote?</p>
 <p>In the past, you would need to hunt through the chain to make sure ‘this one’ is not one of those comment hounds, intent on preying on your benevolent nature to get a free lunch.</p>
 <p>Well.... those days are now and truly over. Just add your name, and ‘Who Didn’t Vote’ will check your account, grab that Chef-d'œuvre of yours, cross-reference the comments against the votes, finally naming and shaming those leeching varmin.</p>
 <p>So what then?</p>
 <p>That’s up to you mate! Ignore them, comment back with no vote, let them know of their dastardly conduct, or be a sucker and give them a vote if you want to encourage this incorrigible behaviour.</p>

  <div id="output">Waiting...</div>

  <script>
    async function getLatestPost(author) {
      const response = await fetch(apiUrl, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          jsonrpc: "2.0",
          method: "condenser_api.get_discussions_by_author_before_date",
          params: [author, "", "1970-01-01T00:00:00", 1],
          id: 1,
        })
      });

      const data = await response.json();
      if (data.result && data.result.length > 0) {
        return data.result[0].permlink;
      } else {
        return null;
      }
    }

    async function getPostVotes(author, permlink) {
      const response = await fetch(apiUrl, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          jsonrpc: "2.0",
          method: "condenser_api.get_content",
          params: [author, permlink],
          id: 1,
        })
      });

      const data = await response.json();
      return data.result?.active_votes.map(v => v.voter) || [];
    }

    async function getPostCommenters(author, permlink) {
      const response = await fetch(apiUrl, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          jsonrpc: "2.0",
          method: "condenser_api.get_content_replies",
          params: [author, permlink],
          id: 1,
        })
      });

      const data = await response.json();
      return data.result?.map(comment => comment.author) || [];
    }

    async function crossReference(author, permlink) {
      const output = document.getElementById("output");
      const voters = await getPostVotes(author, permlink);
      const commenters = await getPostCommenters(author, permlink);

      output.innerHTML = `<span class="cyan">Found POST: '${permlink}'</span>\n--------------------------\n`;

      if (voters.length && commenters.length) {
        commenters.forEach(commenter => {
          if (voters.includes(commenter)) {
            output.innerHTML += `<span class="green"> ${commenter}: Commenter did vote</span>\n`;
          } else {
            output.innerHTML += `<span class="red"> ${commenter}: Commenter DID NOT vote</span>\n`;
          }
        });
      } else {
        output.innerHTML += "No commenters or voters found.";
      }
    }

    async function startAnalysis() {
      const username = document.getElementById("username").value.trim(); // Get the username input
      if (username) {
        const permlink = await getLatestPost(username);
        if (permlink) {
          await crossReference(username, permlink);
        } else {
          document.getElementById("output").textContent = "No post found.";
        }
      } else {
        alert("Stop being a smart-arse, and add a proper username.");
      }
    }
  </script>
</body>
</html>
